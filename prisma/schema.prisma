generator client { provider = "prisma-client-js" }
datasource db { provider = "postgresql" url = env("DATABASE_URL") }

enum Currency { RUB EUR USD TRY }

model Company {
  id        String   @id @default(cuid())
  name      String
  legalName String?
  email     String?
  phone     String?
  website   String?
  address   String?
  logoUrl   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
  quotes    Quote[]
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(ADMIN)
  companyId String
  company   Company  @relation(fields: [companyId], references: [id])
  createdAt DateTime @default(now())
}

enum Role { ADMIN EDITOR VIEWER }

model Client {
  id        String   @id @default(cuid())
  companyId String
  company   Company  @relation(fields: [companyId], references: [id])
  name      String
  contact   String?
  email     String?
  phone     String?
  createdAt DateTime @default(now())
  quotes    Quote[]
}

model Quote {
  id           String   @id @default(cuid())
  companyId    String
  company      Company  @relation(fields: [companyId], references: [id])
  clientId     String?
  client       Client?  @relation(fields: [clientId], references: [id])
  title        String
  eventDate    DateTime?
  platform     String?
  currency     Currency  @default(RUB)
  usnRate      Int       @default(7) // фиксированная ставка УСН
  discountPct  Int       @default(0)
  notes        String?
  publicToken  String    @unique @default(uuid()) // публичная ссылка
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  lines        QuoteLine[]
  terms        Terms?
}

model QuoteLine {
  id        String  @id @default(cuid())
  quoteId   String
  quote     Quote   @relation(fields: [quoteId], references: [id])
  section   String
  name      String
  unit      String
  qty       Decimal @db.Numeric(12,2)
  price     Decimal @db.Numeric(12,2)
  note      String?
  order     Int     @default(0)
}

model Terms {
  id        String  @id @default(cuid())
  quoteId   String  @unique
  quote     Quote   @relation(fields: [quoteId], references: [id])
  includes  String[]
  excludes  String[]
  payment   String?
  sla       String?
}
